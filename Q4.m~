whiteWine = readtable('winequality-white.csv', 'ReadVariableNames', true);
redWine = readtable('winequality-red.csv', 'ReadVariableNames', true);
whiteData = table2array(whiteWine);
redData = table2array(redWine);

redDataX = redData(:, 1:11);
whiteDataX = whiteData(:, 1:11);
redY = redData(:,12);
whiteY = whiteData(:,12);

redAvg = mean(redDataX);
whiteAvg = mean(whiteDataX);

x_str = {'fixed Acidity'; 'Volatile Acidity'; 'Citric Acid'; 'Residual Sugar'; 'Chlorides';
    'Free Sulfur Dioxides'; 'Total Sulfur Dioxide'; 'Density'; 'pH'; 'Sulphates'; 'Alcohol'};
X_str = {'fixed Acidity', 'Volatile Acidity', 'Citric Acid', 'Residual Sugar', 'Chlorides', 'Free Sulfur Dioxides', 'Total Sulfur Dioxide', 'Density', 'pH', 'Sulphates', 'Alcohol'};
% X_str = redWine.Properties.VariableNames;
x = categorical(x_str);
Y_wine = [redAvg'  whiteAvg'];
bar(x, Y_wine);
legend('White wine','Red wine');
title('Bar graph showing the averages of the features of red and white wines');
xlabel('Features');
ylabel('Average values');

% Correlation Matrix for both wines
r_red = corrcoef(redData);
r_white = corrcoef(whiteData);

[B,FitInfo] = lasso(redDataX,redY,'CV',10, 'PredictorNames', X_str );
lassoPlot(B, FitInfo, 'PlotType','Lambda', 'PredictorNames', redWine.Properties.VariableNames);
legend('show')
lassoPlot(B,FitInfo,'PlotType','CV');
legend('show')
idxLambdaMinMSE = FitInfo.IndexMinMSE;
minMSEModelPredictors = FitInfo.PredictorNames(B(:,idxLambdaMinMSE)~=0)
rsfeat = find(B(:, idxLambdaMinMSE));
redSelected = redData(:. rsfeat);

[Bw,FitInfoW] = lasso(whiteDataX,whiteY,'CV',10, 'PredictorNames', X_str);
lassoPlot(Bw, FitInfoW, 'PlotType','Lambda', 'PredictorNames', whiteWine.Properties.VariableNames);
legend('show')
lassoPlot(Bw,FitInfoW,'PlotType','CV');
legend('show')
idxLambdaMinMSEWh = FitInfoW.IndexMinMSE;
minMSEModelPredictorsWh = FitInfoW.PredictorNames(B(:,idxLambdaMinMSEWh)~=0)

% KNN model for red wine using selected features
rKmdl = ClassificationKNN.fit(redDataX, redY);
rloss = resubLoss(rKmdl)
 
% linear regression model
X_Str = {'fixed Acidity', 'Volatile Acidity', 'Citric Acid', 'Residual Sugar', 'Chlorides', 'Free Sulfur Dioxides', 'Total Sulfur Dioxide', 'Density', 'pH', 'Sulphates', 'Alcohol', 'Quality'};
modelR = fitlm(redDataX, redY, 'VarNames',X_Str);
modelW = fitlm(whiteDataX, whiteY, 'VarNames',X_Str);

MSEr = modelR.MSE;
MSEw = modelW.MSE;

